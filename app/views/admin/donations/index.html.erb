<div class="container mt-5">
  <h1 class="mb-4">Administración de Donaciones</h1>
  
  <% if @pending_count > 0 %>
    <div class="alert alert-warning mb-4">
      Hay <strong><%= @pending_count %></strong> donaciones pendientes de revisión.
    </div>
  <% else %>
    <div class="alert alert-success mb-4">
      No hay donaciones pendientes de revisión.
    </div>
  <% end %>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Monto</th>
              <th>Tipo</th>
              <th>Método</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% @donations.each do |donation| %>
              <tr class="<%= 'table-secondary opacity-75' if donation.canceled? %>">
                <td><%= donation.user.email %></td>
                <td><%= number_to_currency(donation.amount) %></td>
                <td>
                  <% if donation.donation_type.present? %>
                    <%= t("enums.donation.donation_type.#{donation.donation_type}", default: "Pendiente") %>
                  <% else %>
                    Pendiente
                  <% end %>
                </td>
                <td>
                  <% case donation.payment_method %>
                  <% when 'bank_transfer' %>
                    <span class="badge bg-secondary">Transferencia</span>
                  <% when 'mercado_pago' %>
                    <span class="badge bg-primary">MercadoPago</span>
                  <% when 'cash' %>
                    <span class="badge bg-warning text-dark">Efectivo</span>
                  <% else %>
                    <span class="badge bg-secondary">Otro</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-<%= donation_status_badge(donation.status) %>">
                    <% if donation.status.present? %>
                      <%= t("enums.donation.status.#{donation.status}", default: "Pendiente") %>
                    <% else %>
                      Pendiente
                    <% end %>
                  </span>
                </td>
                <td><%= donation.created_at.strftime("%d/%m/%Y %H:%M") %></td>
                <td>
                  <%= link_to 'Ver', admin_donation_path(donation), class: 'btn btn-sm btn-outline-primary' %>

                  <% if donation.pending? %>
                    <%= button_to 'Aprobar', 
                                  approve_admin_donation_path(donation), 
                                  method: :patch, 
                                  class: 'btn btn-sm btn-success' %>
                    <%= button_to 'Cancelar', 
                                  cancel_admin_donation_path(donation), 
                                  method: :patch, 
                                  class: 'btn btn-sm btn-danger' %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="card-footer">
      <%= paginate @donations %>
      <div class="text-center text-muted mt-2">
        <small>Mostrando <%= @donations.size %> de <%= @donations.total_count %> donaciones</small>
      </div>
    </div>
  </div>
</div>