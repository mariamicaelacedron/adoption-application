<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm <%= 'border-danger' if @donation.canceled? %>">
        <div class="card-header bg-white">
          <h2 class="h4 mb-0">Donación #<%= @donation.id %></h2>
          <span class="badge bg-<%= donation_status_badge(@donation.status) %>">
            <% if @donation.status.present? %>
              <%= t("enums.donation.status.#{@donation.status}", default: @donation.status&.humanize || 'Pendiente') %>
            <% else %>
              Pendiente
            <% end %>
          </span>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <h5 class="mb-3">Información de Donación</h5>
              <p><strong>Usuario:</strong> <%= @donation.user.email %></p>
              <p><strong>Monto:</strong> <%= number_to_currency(@donation.amount) %></p>
              <p><strong>Tipo:</strong> 
                <% if @donation.donation_type.present? %>
                  <%= t("enums.donation.donation_type.#{@donation.donation_type}", default: @donation.donation_type&.humanize || 'Pendiente') %>
                <% else %>
                  Pendiente
                <% end %>
              </p>
              <p><strong>Método Pago:</strong> <%= @donation.payment_method.present? ? @donation.payment_method.humanize : 'Pendiente' %></p>
              <p><strong>Fecha:</strong> <%= l(@donation.created_at, format: :long) %></p>
            </div>
            
            <div class="col-md-6">
              <% if @donation.pending? %>
                <div class="d-grid gap-2 mb-4">
                  <%= button_to 'Aprobar Donación', 
                                approve_admin_donation_path(@donation),
                                method: :patch,
                                class: 'btn btn-success' %>
                  <%= button_to 'Cancelar Donación',
                                cancel_admin_donation_path(@donation),
                                method: :patch,
                                class: 'btn btn-outline-danger' %>
                </div>
              <% end %>
              
              <% if @donation.payment_proof.attached? %>
                <div class="mb-3">
                  <h5 class="mb-2">Comprobante</h5>
                  <%= link_to 'Descargar comprobante', 
                              rails_blob_path(@donation.payment_proof, disposition: 'attachment'),
                              class: 'btn btn-sm btn-primary' %>
                </div>
              <% end %>
            </div>
          </div>
          
          <div class="card-footer bg-white d-flex justify-content-between align-items-center">
            <%= link_to 'Volver a donaciones', admin_donations_path, class: 'btn btn-secondary' %>

            <div class="btn-group">
              <% if @donation.pending? %>
                <%= button_to 'Aprobar', 
                              approve_admin_donation_path(@donation),
                              method: :patch,
                              class: 'btn btn-success me-2' %>

                <%= button_to 'Cancelar',
                              cancel_admin_donation_path(@donation),
                              method: :patch,
                              class: 'btn btn-warning me-2' %>

                <%= button_to 'Eliminar',
                              admin_donation_path(@donation),
                              method: :delete,
                              form: { class: 'd-inline', data: { turbo_confirm: '¿Estás seguro de eliminar esta donación?' } },
                              class: 'btn btn-danger' %>
              <% elsif @donation.completed? %>
                <span class="text-success">
                  <i class="bi bi-check-circle-fill"></i> Donación completada
                </span>
              <% else %>
                <span class="text-secondary">
                  <i class="bi bi-x-circle-fill"></i> Donación cancelada
                </span>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>